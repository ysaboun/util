
## ‚úÖ Exemple de configuration `application.yml`

```yaml
resilience4j:
  circuitbreaker:
    instances:
      externalApi:
        registerHealthIndicator: true
        slidingWindowType: COUNT_BASED
        slidingWindowSize: 10 # Nombre total d‚Äôappels dans la fen√™tre
        minimumNumberOfCalls: 5 # Seuil pour commencer √† mesurer les erreurs
        failureRateThreshold: 50 # % d‚Äô√©checs avant ouverture (ici, 50%)
        waitDurationInOpenState: 30s # Temps avant tentative d‚Äôun appel (√©tat HALF_OPEN)
        permittedNumberOfCallsInHalfOpenState: 2 # Nb d‚Äôappels test autoris√©s
        automaticTransitionFromOpenToHalfOpenEnabled: true
        maxWaitDurationInHalfOpenState: 5s # Pour forcer la transition
        recordExceptions:
          - java.io.IOException
          - org.springframework.web.client.HttpServerErrorException
        ignoreExceptions:
          - org.springframework.web.client.HttpClientErrorException$BadRequest
```

---

## üîç Explication des param√®tres cl√©s

| Param√®tre | Description |
| ---------------------------------------------- | ------------------------------------------------------- |
| `slidingWindowType` | COUNT\_BASED ou TIME\_BASED (nombre d'appels ou dur√©e) |
| `slidingWindowSize` | Taille de la fen√™tre d‚Äô√©chantillon (ex : 10 appels) |
| `minimumNumberOfCalls` | Minimum d‚Äôappels requis pour √©valuer l'√©tat |
| `failureRateThreshold` | Pourcentage d‚Äô√©checs d√©clenchant l‚Äôouverture du circuit |
| `waitDurationInOpenState` | Temps d‚Äôattente avant test de r√©ouverture |
| `permittedNumberOfCallsInHalfOpenState` | Nb d‚Äôappels test en √©tat HALF\_OPEN |
| `automaticTransitionFromOpenToHalfOpenEnabled` | Reprise automatique sans action externe |
| `recordExceptions` | Exceptions consid√©r√©es comme des √©checs |
| `ignoreExceptions` | Exceptions √† ignorer pour ne pas impacter le circuit |


  * **Activer `automaticTransitionFromOpenToHalfOpenEnabled`** : tr√®s utile dans un syst√®me Kafka pour relancer automatiquement la consommation d√®s que l‚ÄôAPI redevient disponible.
* **`failureRateThreshold: 50`** et `minimumNumberOfCalls: 5` sont des bons points de d√©part.
* **Utiliser avec `@KafkaListener(ackMode = MANUAL)`** pour √©viter de perdre les messages pendant l‚Äô√©tat `OPEN`.
