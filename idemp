Voici un **schÃ©ma de l'idempotence pattern** en **texte Markdown**, utile pour illustrer dans un document technique, un README ou une documentation dâ€™architecture.

---

### ğŸ§© SchÃ©ma de l'idempotence (Markdown)

````markdown
# ğŸ›¡ï¸ Idempotence Pattern

Ce pattern garantit que plusieurs traitements du **mÃªme message** n'entraÃ®nent qu'un **effet unique**, Ã©vitant ainsi les doublons dans les systÃ¨mes distribuÃ©s ou asynchrones.

## ğŸ” Cas d'usage

- Rejeu de message (Kafka, RabbitMQ, etc.)
- Appel dâ€™API REST instable
- Traitement batch relancÃ© aprÃ¨s erreur
- Webhook reÃ§u plusieurs fois

---

## ğŸ“Š SchÃ©ma (ASCII)

                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚ Producteur â”‚
                        â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                       [Message avec ID]
                              â”‚
                              â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Consommateur / API â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚ VÃ©rifier si ID dÃ©jÃ  vu? â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      Oui     â”‚     Non
                       â”‚      â–¼
             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   Traiter l'action
             â”‚                â”‚
       Ignorer / Log         â–¼
                        Sauvegarder ID
                        RÃ©sultat final

---

## âœ… Bonnes pratiques

- Stocker l'`idempotency-key` en base ou cache distribuÃ© (Redis, DB, etc.)
- Expirer les clÃ©s aprÃ¨s un TTL (ex: 24h) si besoin
- Associer l'idempotency Ã  :
  - un `requestId`
  - un `messageId` Kafka
  - un `correlationId` HTTP

---

## ğŸ› ï¸ Exemple REST

```http
POST /paiement
Idempotency-Key: 12345-abcdef

Body: {
  "montant": 100,
  "devise": "EUR"
}
````

Serveur : si une requÃªte avec la mÃªme clÃ© a dÃ©jÃ  Ã©tÃ© traitÃ©e, renvoyer **le mÃªme rÃ©sultat** (HTTP 200) sans retravailler lâ€™action.

```

---

Souhaites-tu ce schÃ©ma en **version image** (avec flÃ¨ches, couleurs, etc.) ou intÃ©grÃ© dans un **document technique plus complet** ?
```
