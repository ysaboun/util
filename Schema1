â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                   1ï¸âƒ£ UTILISATEUR / NAVIGATEUR
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
- Navigateur supportant PWA : Chrome, Firefox, Edge, Safari
- Service Worker actif (sw.js)
- Consentement explicite RGPD obtenu :
    Notification.requestPermission() â†’ "granted"
- DonnÃ©es personnelles pseudonymisÃ©es
- Erreurs possibles :
    - Consentement refusÃ© â†’ push non abonnÃ©
    - Service Worker non supportÃ© â†’ fallback email/SMS

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
           2ï¸âƒ£ CREATION DU PUSH SUBSCRIPTION
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
navigator.serviceWorker.ready.then(
    registration.pushManager.subscribe({
        userVisibleOnly: true,
        applicationServerKey: VAPID_PUBLIC_KEY (256 bits, EC P-256)
    })
)

PushSubscription JSON renvoyÃ© :
{
  "endpoint": "https://fcm.googleapis.com/fcm/send/abcd1234...",
  "keys": {
    "p256dh": "BElcT1s8u1Q...", // ClÃ© publique client EC P-256
    "auth": "8bT9sW..."          // ClÃ© courte HMAC 16 octets
  }
}

Transmission au serveur backend :
- MÃ©thode HTTPS POST
- Corps : JSON subscription
- Pseudonymisation obligatoire RGPD
- Erreurs possibles :
    - HTTPS non valide â†’ push rejetÃ©
    - Endpoint expirÃ© â†’ nettoyage nÃ©cessaire

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         3ï¸âƒ£ STOCKAGE BACKEND ET PSEUDONYMISATION
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
- Stockage sÃ©curisÃ© (PostgreSQL / MongoDB)
- Chiffrement AES-256 des abonnements
- Champs :
    - user_id interne/pseudonyme
    - navigateur/version
    - endpoint, p256dh, auth
    - date crÃ©ation
    - consentement RGPD
- Rotation rÃ©guliÃ¨re des clÃ©s
- Erreurs possibles :
    - DB inaccessible â†’ push non sauvegardÃ©
    - DonnÃ©es personnelles mal pseudonymisÃ©es â†’ non-conformitÃ© RGPD

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
           4ï¸âƒ£ GÃ‰NÃ‰RATION DU MESSAGE PUSH
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Payload JSON :
{
  "title": "Votre commande est livrÃ©e !",
  "body": "Cliquez ici pour donner votre avis",
  "icon": "/assets/icon.png",
  "data": { "orderId": "1234", "callbackUrl": "https://..." }
}

- Templates dynamiques selon lâ€™Ã©vÃ©nement
- VÃ©rification consentement utilisateur

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
           5ï¸âƒ£ CHIFFREMENT E2E DU MESSAGE
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
- ClÃ© symÃ©trique AES-128-GCM gÃ©nÃ©rÃ©e cÃ´tÃ© serveur
- DÃ©rivation clÃ© via ECDH (server_private_key 256 bits + p256dh client)
- AES-GCM assure :
    - ConfidentialitÃ©
    - IntÃ©gritÃ© (tag 128 bits)
- Payload chiffrÃ©e envoyÃ©e
- Erreurs possibles :
    - ClÃ© incorrecte â†’ dÃ©chiffrement cÃ´tÃ© client impossible
    - Payload mal formÃ©e â†’ rejet Push Service

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
              6ï¸âƒ£ AUTHENTIFICATION VAPID
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
- JWT VAPID signÃ© EC P-256 :
Header :
{
  "alg": "ES256",
  "typ": "JWT"
}
Payload :
{
  "aud": "https://fcm.googleapis.com/fcm/send/abcd1234...",
  "exp": timestamp+12h,
  "sub": "mailto:admin@example.com"
}
- Authorization HTTP Header : WebPush <JWT>
- VÃ©rification Push Service obligatoire
- Erreurs possibles :
    - JWT expirÃ© â†’ push rejetÃ©
    - Signature invalide â†’ push rejetÃ©

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
     7ï¸âƒ£ ENVOI AU PUSH SERVICE DU NAVIGATEUR
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
- Endpoint : PushSubscription.endpoint
- MÃ©thode HTTPS POST (HTTP/2)
- Headers : TTL, Content-Encoding=aes128gcm, Authorization=JWT
- Push Service (FCM / Mozilla / APNs) :
    - VÃ©rifie JWT VAPID
    - Stocke si utilisateur offline (TTL configurable)
    - Envoi via canal persistant (HTTP2/WebSocket)
- Erreurs possibles :
    - Endpoint 404/410 â†’ abonnement pÃ©rimÃ© â†’ suppression
    - Volume trop Ã©levÃ© â†’ throttling nÃ©cessaire

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
             8ï¸âƒ£ SERVICE WORKER / PWA NAVIGATEUR
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
self.addEventListener('push', event => {
    const payload = decrypt(event.data.arrayBuffer(), clientPrivateKey);
    self.registration.showNotification(payload.title, {
        body: payload.body,
        icon: payload.icon,
        data: payload.data
    });
});

- DÃ©chiffrement AES-GCM local
- Gestion clic :
self.addEventListener('notificationclick', event => {
    event.notification.close();
    clients.openWindow(payload.data.callbackUrl);
});
- DÃ©sabonnement possible Ã  tout moment
- Erreurs possibles :
    - ClÃ© privÃ©e non disponible â†’ dÃ©chiffrement impossible
    - Service Worker inactif â†’ notification perdue

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
           9ï¸âƒ£ UTILISATEUR FINAL / INTERACTION
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
- Lit / clique / ignore la notification
- Interaction remontÃ©e au backend pour analytics
- Statistiques pseudonymisÃ©es :
    - Push envoyÃ©, reÃ§u, clic
    - Taux dâ€™Ã©chec / abonnements invalides

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
            ğŸ”’ POINTS SENSIBLES SÃ‰CURITÃ‰ & RGPD
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
- Consentement explicite avant abonnement
- Pseudonymisation + stockage chiffrÃ©
- Chiffrement E2E AES-GCM + ECDH
- JWT VAPID : authentification serveur
- TLS/HTTPS obligatoire sur tous les flux
- TTL et purge automatique des abonnements expirÃ©s
- DÃ©sabonnement immÃ©diat possible cÃ´tÃ© client
- Logs pseudonymisÃ©s pour audit RGPD

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
